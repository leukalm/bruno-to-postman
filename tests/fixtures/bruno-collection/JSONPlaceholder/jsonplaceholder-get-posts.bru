meta {
  name: Get All Posts
  type: http
  seq: 1
}

get {
  url: https://jsonplaceholder.typicode.com/posts
}

params:query {
  _limit: 10
  ~_page: 1
}

headers {
  Accept: application/json
  User-Agent: Bruno-to-Postman-Test
}

script:pre-request {
  // Log the request
  console.log("Fetching posts from JSONPlaceholder API");

  // Set timestamp for performance tracking
  bru.setVar("requestStartTime", Date.now());
}

tests {
  // Test response status
  test("Status code is 200", function() {
    expect(res.status).to.equal(200);
  });

  // Test response is JSON
  test("Response is JSON", function() {
    expect(res.headers["content-type"]).to.contain("application/json");
  });

  // Test response structure
  test("Response is an array", function() {
    expect(Array.isArray(res.body)).to.be.true;
  });

  test("Response contains posts", function() {
    expect(res.body.length).to.be.greaterThan(0);
    expect(res.body.length).to.be.lessThanOrEqual(100);
  });

  // Test post structure
  test("Posts have correct structure", function() {
    const firstPost = res.body[0];
    expect(firstPost).to.have.property("userId");
    expect(firstPost).to.have.property("id");
    expect(firstPost).to.have.property("title");
    expect(firstPost).to.have.property("body");
  });

  // Save first post ID for subsequent requests
  if (res.body && res.body.length > 0) {
    bru.setVar("firstPostId", res.body[0].id);
    console.log("Saved first post ID:", res.body[0].id);
  }

  // Performance check
  const requestEndTime = Date.now();
  const requestStartTime = bru.getVar("requestStartTime");
  const duration = requestEndTime - requestStartTime;

  test("Response time is acceptable", function() {
    expect(duration).to.be.below(2000);
  });

  console.log("Request completed in", duration, "ms");
}

docs {
  This request fetches all posts from the JSONPlaceholder API.

  JSONPlaceholder is a free fake REST API for testing and prototyping.
  URL: https://jsonplaceholder.typicode.com

  Query parameters:
  - _limit: Limit the number of results (optional)
  - _page: Page number for pagination (optional, disabled by default)

  Response: Array of post objects with userId, id, title, and body fields.
}
